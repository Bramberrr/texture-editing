<!-- edit.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Edit {{ filename }}</title>
  <style>
    .method-block {
      display: inline-block;
      margin: 0 20px;
      text-align: center;
    }
    .slider-value {
      font-size: 14px;
      margin-top: 4px;
    }
    input[type="range"] {
  accent-color: var(--slider-color, blue); /* fallback is blue */
}
  </style>
  <script>
    function updateGloss(method) {
    const sliderId = method + "_slider";
    const slider = document.getElementById(sliderId);
    const s = slider.value;

    fetch(`/api/update_image/?index={{ index }}&method=${method}&strength=${s}&domain={{ domain }}`)
      .then(r => r.json()).then(data => {
        document.getElementById(method + "_img").src = data.img_url;
        document.getElementById(method + "_gloss").innerText = data.sim_glossy;
        document.getElementById(method + "_matte").innerText = data.sim_matte;
        document.getElementById(method + "_val").innerText = s;
        document.getElementById(method + "_simimg").innerText = data.sim_img;
        document.getElementById(method + "_stsim").innerText = data.stsim;
        document.getElementById(method + "_sw").innerText = data.sw;
        document.getElementById(method + "_nat").innerText = data.nat;
        // âœ… update color AFTER setting `nat`
        const isNatural = data.nat === true || data.nat === "true";
        slider.style.setProperty('--slider-color', isNatural ? 'blue' : 'red');
      });
  }


    function updateRough(method) {
    const sliderId = "rough_" + method + "_slider";
    const slider = document.getElementById(sliderId);
    const s = slider.value;
    fetch(`/api/update_image_rough/?index={{ index }}&method=${method}&strength=${s}&domain={{ domain }}`)
      .then(r => r.json()).then(data => {
        document.getElementById("rough_" + method + "_img").src = data.img_url;
        document.getElementById("rough_" + method + "_rough").innerText = data.sim_rough;
        document.getElementById("rough_" + method + "_smooth").innerText = data.sim_smooth;
        document.getElementById("rough_" + method + "_val").innerText = s;
        document.getElementById("rough_" + method + "_simimg").innerText = data.sim_img;
        document.getElementById("rough_" + method + "_stsim").innerText = data.stsim;
        document.getElementById("rough_" + method + "_sw").innerText = data.sw;
        document.getElementById("rough_" + method + "_nat").innerText = data.nat;
        const isNatural = data.nat === true || data.nat === "true";
        slider.style.setProperty('--slider-color', isNatural ? 'blue' : 'red');
      });
  }

  function updateClipAny() {
  const sliderId = "rough_clip_any_slider";
  const slider = document.getElementById(sliderId);
  const s = slider.value;
  const attr = document.getElementById("clip_any_attr").value;
  document.getElementById("rough_clip_any_val").innerText = s;

  fetch(`/api/update_image_clip_any/?index={{ index }}&method=clip_any&strength=${s}&domain={{ domain }}&attr=${attr}`)
    .then(r => r.json()).then(data => {
      document.getElementById("rough_clip_any_img").src = data.img_url;
      document.getElementById("rough_clip_any_gloss").innerText = data.sim_glossy;
      document.getElementById("rough_clip_any_matte").innerText = data.sim_matte;
      document.getElementById("rough_clip_any_rough").innerText = data.sim_rough;
      document.getElementById("rough_clip_any_smooth").innerText = data.sim_smooth;
      document.getElementById("rough_clip_any_simimg").innerText = data.sim_img;
      document.getElementById("rough_clip_any_stsim").innerText = data.stsim;
      document.getElementById("rough_clip_any_sw").innerText = data.sw;
      document.getElementById("rough_clip_any_nat").innerText = data.nat;
      const isNatural = data.nat === true || data.nat === "true";
      slider.style.setProperty('--slider-color', isNatural ? 'blue' : 'red');
    });
}

  </script>
</head>
<body>
  <h1>Editing {{ index }} - {{ filename }}</h1>

  <!-- Original Preview -->
  <div style="text-align: center; margin-bottom: 20px;">
    <h2>Original Image</h2>
    <img src="/static/{{ preview_path }}/{{ filename }}.png" width="256" height="256">
    <div style="margin-top: 10px;">
      Glossy: <span>{{ original_scores.glossy }}</span> |
      Matte: <span>{{ original_scores.matte }}</span> |
      Rough: <span>{{ original_scores.rough }}</span> |
      Smooth: <span>{{ original_scores.smooth }}</span>
    </div>
  </div>

  <hr>

  <!-- Gloss Editor -->
  <h2>Gloss Editing</h2>
  <div style="display: flex; justify-content: center;">
    {% for method in methods %}
    <div class="method-block">
      <h3>{{ method|title }}</h3>
      <img id="{{ method }}_img" width="256" height="256" src="/static/{{ preview_path }}/{{ filename }}.png">
      <br>
      <input type="range" id="{{ method }}_slider" min="-10" max="10" step="0.1" value="0"
             oninput="updateGloss('{{ method }}')">
      <div class="slider-value">Value: <span id="{{ method }}_val">0</span></div>
      <div>Glossy: <span id="{{ method }}_gloss">--</span></div>
      <div>Matte: <span id="{{ method }}_matte">--</span></div>
      <div>Sim Img: <span id="{{ method }}_simimg">--</span></div>
      <div>STSIM: <span id="{{ method }}_stsim">--</span></div>
      <div>SW: <span id="{{ method }}_sw">--</span></div>
      <div>isNatural: <span id="{{ method }}_nat">--</span></div>
    </div>
    {% endfor %}
  </div>

  <hr>

  <!-- Roughness Editor -->
  <h2>Roughness Editing</h2>
  <div style="display: flex; justify-content: center;">
    {% for method in rough_methods %}
    <div class="method-block">
      <h3>{{ method|title }}</h3>
      <img id="rough_{{ method }}_img" width="256" height="256" src="/static/{{ preview_path }}/{{ filename }}.png">
      <br>
      <input type="range" class="slider" id="rough_{{ method }}_slider" min="-10" max="10" step="0.1" value="0"
             oninput="updateRough('{{ method }}')">
      <div class="slider-value">Value: <span id="rough_{{ method }}_val">0</span></div>
      <div>Rough: <span id="rough_{{ method }}_rough">--</span></div>
      <div>Smooth: <span id="rough_{{ method }}_smooth">--</span></div>
      <div>Sim Img: <span id="rough_{{ method }}_simimg">--</span></div>
      <div>STSIM: <span id="rough_{{ method }}_stsim">--</span></div>
      <div>SW: <span id="rough_{{ method }}_sw">--</span></div>
      <div>isNatural: <span id="rough_{{ method }}_nat">--</span></div>
    </div>
    {% endfor %}
    <!-- Roughness Editing - CLIP Any -->
    <div class="method-block">
      <h3>CLIP Any</h3>
      <img id="rough_clip_any_img" class="slider" width="256" height="256" src="/static/{{ preview_path }}/{{ filename }}.png"><br>

      <!-- Attribute Dropdown -->
      <label for="clip_any_attr">Attribute:</label>
      <select id="clip_any_attr" onchange="updateClipAny()">
        <option value="rough">Rough</option>
        <option value="glossy">Glossy</option>
        <option value="highlighted">Highlighted</option>
        <option value="saturation">Saturation</option>
        <option value="sharp">Sharp</option>
        <option value="fine_scale">Fine</option>
        <option value="uniformity">Uniformity</option>
        <option value="wet">Wet</option>
        <option value="warm_toned">Warm toned</option>
        <option value="brightness">Bright</option>
        <option value="regular">Regular</option>
        <option value="metallic">Metallic</option>
        <option value="translucent">Translucent</option>
        <!-- Add more attributes if needed -->
      </select><br>

      <!-- Strength Slider -->
      <input type="range" id="rough_clip_any_slider" min="-10" max="10" step="1" value="0" oninput="updateClipAny()">
      <div class="slider-value">Value: <span id="rough_clip_any_val">0</span></div>

      <div>Glossy: <span id="rough_clip_any_gloss">--</span></div>
      <div>Matte: <span id="rough_clip_any_matte">--</span></div>
      <div>Rough: <span id="rough_clip_any_rough">--</span></div>
      <div>Smooth: <span id="rough_clip_any_smooth">--</span></div>
      <div>Sim Img: <span id="rough_clip_any_simimg">--</span></div>
      <div>STSIM: <span id="rough_clip_any_stsim">--</span></div>
      <div>SW: <span id="rough_clip_any_sw">--</span></div>
      <div>isNatural: <span id="rough_clip_any_nat">--</span></div>
    </div>

  </div>
  <h3>Answer the following questions:</h3>

<!-- Yes/No Questions -->
<div>
  <p>Can this be made glossier? 
    <button onclick="submitAnswer('glossier', true)">Yes</button>
    <button onclick="submitAnswer('glossier', false)">No</button>
  </p>
  <p>Can this be made more matte? 
    <button onclick="submitAnswer('matte', true)">Yes</button>
    <button onclick="submitAnswer('matte', false)">No</button>
  </p>
  <p>Can this be made rougher? 
    <button onclick="submitAnswer('rough', true)">Yes</button>
    <button onclick="submitAnswer('rough', false)">No</button>
  </p>
  <p>Can this be made smoother? 
    <button onclick="submitAnswer('smooth', true)">Yes</button>
    <button onclick="submitAnswer('smooth', false)">No</button>
  </p>
</div>

<!-- Best Method Questions -->
<h3>Which method best enhances the attributes?</h3>
<div>
  <p>Best method for glossiness:</p>
  <button onclick="submitAnswer('glossiness', 'bs')">BS</button>
  <button onclick="submitAnswer('glossiness', 'scurve')">SCurve</button>
  <button onclick="submitAnswer('glossiness', 'clip')">CLIP</button>
</div>

<div>
  <p>Best method for roughness:</p>
  <button onclick="submitAnswer('roughness', 'bs')">BS</button>
  <button onclick="submitAnswer('roughness', 'clip')">CLIP</button>
</div>

<script>
  function submitAnswer(attr, value) {
    fetch(`/api/submit_answer/?index={{ index }}&domain={{ domain }}&attribute=${attr}&value=${value}`)
      .then(r => r.json())
      .then(data => alert(data.message));
  }
</script>


</body>
</html>
